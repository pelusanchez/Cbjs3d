(function(){var b=function(d){if(window.requestAnimationFrame){window.requestAnimationFrame(d)}else{if(window.mozRequestAnimationFrame){window.mozRequestAnimationFrame(d)}else{if(window.msRequestAnimationFrame){window.msRequestAnimationFrame(d)}else{if(window.webkitRequestAnimationFrame){window.webkitRequestAnimationFrame(d)}else{setTimeout(d,35)}}}}};var a=a||{};a.a=function(d){return document.getElementById(d)};var c=c||{};c.elements=[];c.requestId=0;c.conf;c.last_device_orientation=[-1,-1,-1];c.first_device_orientation=[-1,-1,-1];c.eventData={};c.fsTags=(function(){var d={};if(document.exitFullscreen){d.request="requestFullscreen";d.exit="exitFullscreen";d.element="fullscreenElement"}else{if(document.webkitExitFullscreen){d.request="webkitRequestFullscreen";d.exit="webkitExitFullscreen";d.element="webkitFullscreenElement"}else{if(document.webkitCancelFullScreen){d.request="webkitRequestFullScreen";d.exit="webkitCancelFullscreen";d.element="webkitCurrentFullScreenElement"}else{if(document.mozCancelFullScreen){d.request="mozRequestFullscreen";d.exit="mozCancelFullScreen";d.element="mozFullScreenElement"}else{if(document.msExitFullscreen){d.request="msRequestFullscreen";d.exit="msExitFullscreen";d.element="msFullscreenElement"}}}}}return d})();c.isAndroid=function(){return(navigator.userAgent.toLowerCase().indexOf("android")>-1)};c.isIphone=function(){return(navigator.userAgent.toLowerCase().indexOf("iphone")>-1)};c.isChrome=function(){return(navigator.userAgent.toLowerCase().indexOf("chrome")>-1)};c.isMobile=function(){return(c.isAndroid()||c.isIphone())};c.start=function(d){if(d.div!==undefined&&d.type!==undefined){var e=c.elements.push(d);c.boot(e-1)}else{c.displayError("configuration: div or type not found!")}};c.boot=function(e){var d=c.elements[e];d.port_view=screen.width*(screen.devicePixelRatio||1);d.divElm=a.a(d.div);if(d.divElm.className!=""){d.divElm.className+=" "}d.divElm.className+="fsElm";d.divElm.innerHTML='<div id="'+d.div+'maskDiv" class="maskDiv" style="line-height: '+d.divElm.style.height+';">Click to view</div><div id="'+d.div+'_right_eye" class="right_eye"></div><div id="'+d.div+'_left_eye" class="left_eye"></div>';d.divElmL=a.a(d.div+"_right_eye");d.divElmR=a.a(d.div+"_left_eye");d.divElmL.style.width=d.divElmR.style.width=d.divElm.style.width/2;switch(d.type.toLowerCase()){case"image":c.bootImage(e);break;case"landscape":c.bootLandscape(e);break;case"cube":break;case"info":default:c.displayError("invalid type.");break}d.divElm.addEventListener("click",function(){c.select(e)},false)};c.bootImage=function(e){var d=c.elements[e];d.divElmR.style.backgroundImage="url('"+d.right+"')";d.divElmL.style.backgroundImage="url('"+d.left+"')"};c.bootLandscape=function(f){var e=c.elements[f];var d=new Image();if(e.view===undefined){e.view=360}d.src=e.image;d.onload=function(){var g=Math.round(d.width*0.1);if(g==0||d.width<d.height){c.displayError("Landscape not valid")}else{e.divElmL.style.backgroundImage="url('"+d.src+"')";e.divElmL.style.backgroundPosition=(d.width*0.48)+"px 0px";e.divElmL.style.backgroundSize="auto 100%";e.divElmR.style.backgroundImage="url('"+d.src+"')";e.divElmR.style.backgroundPosition=(d.width*0.5)+"px 0px";e.divElmR.style.backgroundSize="auto 100%"}};e.img=d};c.select=function(d){if(c.elements.length>d){c.conf=c.elements[d];if(c.conf.type=="landscape"){c.imgFactor=c.conf.img.width/c.conf.img.height*screen.height/2}c.toggleFullscreen()}};c.requestFS=function(f){try{f[c.fsTags.request]();a.a(c.conf.div+"maskDiv").style.display="none";return true}catch(d){return false}};c.isFS=function(d){return(document[c.fsTags.element]!=null)};c.exitFS=function(){a.a(c.conf.div+"maskDiv").style.display="block";document[c.fsTags.exit]()};c.toggleFullscreen=function(){if(c.isFS()){c.exitFS()}else{if(c.isLandscape()){if(c.requestFS(c.conf.divElm)){c.getMotion()}else{c.displayError("Unable to fullscreen. Try with other browser.")}}else{c.displayError("Put the device in landscape mode.")}}};c.displayError=function(f){var d=document.createElement("div");if(document.body.querySelector("#_err_display")!==null){try{document.body.removeChild(d)}catch(f){}}d.id="_err_display";d.style="position:fixed; top:20px; left:20px; right:20px; background:rgba(20,20,20,0.8); border-radius:5px 5px; z-index:999; height:50px; animation:show_and_remove_opacity ease-in 4s;";document.body.appendChild(d);d.innerHTML='<span style="color:#EE1111;margin-left:20px; margin-top:20px;">Error:</span><span style="color:#FEFEFE; margin-top:20px;">'+f+"</span>";setTimeout(function(){if(document.body.querySelector("#_err_display")!==null){document.body.removeChild(d)}},4000)};c.isLandscape=function(){return(screen.height<screen.width)};c.onResize=function(d){if(!c.isLandscape()){c.exitFS()}};c.getMotion=function(){if(c.eventData.alpha>=0&&c.eventData.alpha<=360){c.first_device_orientation=[c.eventData.alpha,c.eventData.beta,c.eventData.gamma]}else{c.first_device_orientation=[0,0,0]}b(c.animateMove)};c.removeMotion=function(){};c.requestMove=function(d){try{c.eventData={alpha:Math.floor(d.alpha*10)/10,beta:Math.floor(d.beta*10)/10,gamma:Math.floor(d.gamma*10)/10}}catch(f){c.displayError("Cant move device due to hardware error!")}};c.animateMove=function(){if(c.isFS()){c.requestId=b(c.animateMove);switch(c.conf.type){case"landscape":c.motionLandscape(c.eventData);break;default:break}c.last_device_orientation=[c.eventData.alpha,c.eventData.beta,c.eventData.gamma]}};c.motionLandscape=function(e){var d;var f;if(c.first_device_orientation[0]<=c.conf.view/2){d=c.conf.view/2+c.first_device_orientation[0]}else{d=c.conf.view/2-c.first_device_orientation[0]}if(e.alpha>d||e.alpha<c.first_device_orientation[0]){if(e.alpha>c.first_device_orientation[0]){f=e.alpha-c.first_device_orientation[0]}else{f=(360-c.first_device_orientation[0])+e.alpha}f=360-f}else{f=c.first_device_orientation[0]-e.alpha;if(f>0){f-=360}}f/=-180;if(Math.abs(e.beta)>90){(f<0)?f+=1:f-=1}var g=f*c.imgFactor;c.conf.divElmR.style.backgroundPosition=(g-c.conf.port_view*0.1)+" 0px";c.conf.divElmL.style.backgroundPosition=g+" 0px"};window.Cbjs3d=function(d){if(d===undefined){c.displayError("Undefined configuration!");return false}else{c.start(d);return true}};window.addEventListener("deviceorientation",function(d){c.requestMove(d)},false);window.addEventListener("orientationchange",c.onResize,false)})();
